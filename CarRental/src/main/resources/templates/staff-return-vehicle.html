<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Nh·∫≠n xe</title>
    <link rel="stylesheet" th:href="@{/css/staff.css}">
</head>
<body>

<div class="staff-container">
    <nav class="sidebar-staff">
        <div class="logo">‚ö°Ô∏è EV Station</div>
        <ul>
            <li><a th:href="@{/staff/station-grid}">Qu·∫£n l√Ω xe</a></li>
            <li><a th:href="@{/staff/return}" class="active">Nh·∫≠n xe</a></li>
            <li><a th:href="@{/staff/deliver}">Giao xe</a></li>
            <li><a th:href="@{/staff/verify}">X√°c th·ª±c</a></li>
            <li><a th:href="@{/staff/vehicle-reports}">B√°o c√°o s·ª± c·ªë</a></li>
            <li><a th:href="@{/logout}">ƒêƒÉng xu·∫•t</a></li>
        </ul>
    </nav>

    <div class="main-content-staff">
        <header class="content-header-staff">
            <div class="header-title">Nh·∫≠n xe</div>
        </header>

        <main class="content-body-staff">

            <!-- Section T√¨m ki·∫øm -->
            <div class="deliver-search-section">
                <div class="search-row">
                    <div class="search-group">
                        <label for="searchPlate">T√¨m ki·∫øm theo bi·ªÉn s·ªë:</label>
                        <input type="text" id="searchPlate" class="search-input" placeholder="Nh·∫≠p bi·ªÉn s·ªë...">
                    </div>
                    <div class="search-group">
                        <label for="searchCustomer">T√¨m ki·∫øm theo t√™n:</label>
                        <input type="text" id="searchCustomer" class="search-input" placeholder="Nh·∫≠p t√™n kh√°ch h√†ng...">
                    </div>
                </div>
            </div>

            <!-- B·∫£ng danh s√°ch tr·∫£ xe -->
            <div class="deliver-table-section">
                <table class="deliver-table">
                    <thead>
                        <tr>
                            <th>Bi·ªÉn s·ªë xe</th>
                            <th>Lo·∫°i xe</th>
                            <th>T√™n ng∆∞·ªùi thu√™</th>
                            <th>Ng√†y thu√™</th>
                            <th>Tr·∫°ng th√°i thanh to√°n</th>
                            <th>H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="returnTableBody">
                        <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c t·∫£i t·ª´ API -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>
</div>

<!-- Modal Tr·∫£ xe -->
<div id="returnModal" class="modal">
    <div class="modal-content deliver-modal-content">
        <div class="modal-header deliver-modal-header">
            <h2>Chi ti·∫øt h·ª£p ƒë·ªìng</h2>
            <button type="button" class="close-btn" onclick="closeReturnModal()">&times;</button>
        </div>
        <div class="modal-body deliver-modal-body">
            <!-- Ph·∫ßn 1: Th√¥ng tin xe v√† kh√°ch h√†ng -->
            <div class="modal-section">
                <div class="form-grid-2">
                    <div class="form-group">
                        <label>Bi·ªÉn s·ªë xe:</label>
                        <input type="text" id="returnPlate" disabled>
                    </div>
                    <div class="form-group">
                        <label>Lo·∫°i xe:</label>
                        <input type="text" id="returnVehicleType" disabled>
                    </div>
                </div>
                <div class="form-group">
                    <label>T√™n ng∆∞·ªùi thu√™:</label>
                    <input type="text" id="returnCustomer" disabled>
                </div>
            </div>

            <!-- Ph·∫ßn 2: Th√¥ng tin thu√™ xe -->
            <div class="modal-section">
                <h3 class="modal-section-title">üìÖ Th√¥ng tin thu√™ xe</h3>
                <div class="form-grid-3">
                    <div class="form-group">
                        <label>Ng√†y b·∫Øt ƒë·∫ßu:</label>
                        <input type="text" id="returnStartDate" disabled>
                    </div>
                    <div class="form-group">
                        <label>Ng√†y k·∫øt th√∫c:</label>
                        <input type="text" id="returnEndDate" disabled>
                    </div>
                    <div class="form-group">
                        <label>S·ªë ng√†y:</label>
                        <input type="text" id="returnRentalDays" disabled>
                    </div>
                </div>
            </div>

            <!-- Ph·∫ßn 3b: D·ªØ li·ªáu check-in / y√™u c·∫ßu tr·∫£ -->
            <div class="modal-section">
                <h3 class="modal-section-title">üìç Th√¥ng tin nh·∫≠n v√† tr·∫£ xe</h3>
                <div class="form-grid-2">
                    <div class="form-group">
                        <label>Th·ªùi gian check-in:</label>
                        <input type="text" id="returnCheckinTime" disabled>
                    </div>
                    <div class="form-group">
                        <label>V·ªã tr√≠ check-in:</label>
                        <input type="text" id="returnCheckinLoc" disabled>
                    </div>
                    <div class="form-group">
                        <label>Th·ªùi gian y√™u c·∫ßu tr·∫£:</label>
                        <input type="text" id="returnRequestTime" disabled>
                    </div>
                    <div class="form-group">
                        <label>V·ªã tr√≠ y√™u c·∫ßu tr·∫£:</label>
                        <input type="text" id="returnRequestLoc" disabled>
                    </div>
                    <div class="form-group">
                        <label>Ghi ch√∫ t·ª´ kh√°ch:</label>
                        <input type="text" id="returnCustomerNote" disabled>
                    </div>
                </div>
            </div>

            <!-- Ph·∫ßn 3c: ·∫¢nh xe tr∆∞·ªõc khi giao (t·ª´ deliveryPhotoData) -->
            <div class="modal-section">
                <h3 class="modal-section-title">üì∏ ·∫¢nh xe tr∆∞·ªõc khi giao</h3>
                <div style="border: 2px dashed #ccc; border-radius: 6px; padding: 15px; text-align: center; background-color: #f9f9f9;">
                    <div id="deliveryPhotoPreviewBox" style="display: none;">
                        <img id="deliveryPhotoPreviewImg" src="" style="max-width: 100%; max-height: 300px; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    </div>
                    <div id="noDeliveryPhotoBox" style="color: #999; font-style: italic; padding: 20px;">
                        Kh√¥ng c√≥ ·∫£nh xe tr∆∞·ªõc khi giao
                    </div>
                </div>
            </div>

            <!-- Ph·∫ßn 3d: Ch·ª•p ·∫£nh xe sau khi nh·∫≠n -->
            <div class="modal-section">
                <h3 class="modal-section-title">üì∑ Ch·ª•p ·∫£nh xe sau khi nh·∫≠n</h3>
                <div style="border: 2px dashed #ccc; border-radius: 6px; padding: 15px; text-align: center; background-color: #f9f9f9;">
                    <!-- Video t·ª´ camera -->
                    <video id="returnVideoStream" autoplay playsinline style="width: 100%; max-height: 250px; border-radius: 6px; display: none; background-color: #000;"></video>

                    <!-- Canvas ƒë·ªÉ ch·ª•p ·∫£nh -->
                    <canvas id="returnPhotoCanvas" style="display: none;"></canvas>

                    <!-- Preview ·∫£nh sau khi ch·ª•p -->
                    <div id="returnPhotoPreview" style="display: none;">
                        <img id="returnPreviewImg" src="" style="max-width: 100%; max-height: 200px; border-radius: 4px;">
                        <p id="returnPhotoFileName" style="font-size: 12px; color: #666; margin-top: 5px;"></p>
                    </div>

                    <!-- Buttons -->
                    <div id="returnCameraControls">
                        <button type="button" class="btn btn-small btn-small-primary" onclick="startReturnCamera()" style="width: auto; padding: 10px 20px; border: none; border-radius: 6px; background-color: #3498db; color: white; cursor: pointer; font-weight: 600; margin: 5px;">
                            üì∑ M·ªü Camera
                        </button>
                    </div>

                    <!-- Capture & Retake buttons (hi·ªÉn th·ªã khi camera ƒëang b·∫≠t) -->
                    <div id="returnCaptureControls" style="display: none;">
                        <button type="button" class="btn btn-small" onclick="captureReturnPhoto()" style="width: auto; padding: 10px 20px; border: none; border-radius: 6px; background-color: #2ecc71; color: white; cursor: pointer; font-weight: 600; margin: 5px;">
                            üì∏ Ch·ª•p ·∫¢nh
                        </button>
                        <button type="button" class="btn btn-small" onclick="closeReturnCamera()" style="width: auto; padding: 10px 20px; border: none; border-radius: 6px; background-color: #e74c3c; color: white; cursor: pointer; font-weight: 600; margin: 5px;">
                            ‚úï ƒê√≥ng Camera
                        </button>
                    </div>

                    <!-- Retake button (hi·ªÉn th·ªã khi ƒë√£ ch·ª•p xong) -->
                    <div id="returnRetakeControls" style="display: none;">
                        <button type="button" class="btn btn-small" onclick="resetReturnPhoto()" style="width: auto; padding: 10px 20px; border: none; border-radius: 6px; background-color: #f39c12; color: white; cursor: pointer; font-weight: 600; margin: 5px;">
                            üîÑ Ch·ª•p L·∫°i
                        </button>
                    </div>
                </div>
            </div>

            <!-- Ph·∫ßn 3: Th√¥ng tin thanh to√°n -->
            <div class="modal-section">
                <h3 class="modal-section-title">üí≥ Th√¥ng tin thanh to√°n</h3>
                <div class="form-grid-2">
                    <div class="form-group">
                        <label>T·ªïng ti·ªÅn:</label>
                        <input type="text" id="returnTotal" disabled>
                    </div>
                    <div class="form-group">
                        <label>Tr·∫°ng th√°i TT:</label>
                        <input type="text" id="returnPaymentStatus" disabled>
                    </div>
                </div>
            </div>

            <!-- Ph·∫ßn 4: Ph√≠ ph√°t sinh & ghi ch√∫ -->
            <div class="modal-section">
                <h3 class="modal-section-title">üí∏ Ph√≠ ph√°t sinh & ghi ch√∫</h3>
                <div class="form-grid-2">
                    <div class="form-group">
                        <label>Ph√≠ ph√°t sinh:</label>
                        <input type="number" id="returnDamageFee" min="0" step="0.01" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>Ghi ch√∫:</label>
                        <input type="text" id="returnNote" placeholder="Ghi ch√∫ (t√πy ch·ªçn)">
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeReturnModal()">H·ªßy</button>
            <button type="button" class="btn btn-primary" onclick="confirmReturn()">X√°c nh·∫≠n tr·∫£</button>
        </div>
    </div>
</div>

<script th:src="@{/js/staff-return-vehicle.js}"></script>

</body>
</html>

