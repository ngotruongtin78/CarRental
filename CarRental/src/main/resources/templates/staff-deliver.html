<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Giao xe</title>
    <link rel="stylesheet" th:href="@{/css/staff.css}">
</head>
<body>

<div class="staff-container">
    <nav class="sidebar-staff">
        <div class="logo">‚ö°Ô∏è EV Station</div>
        <ul>
            <li><a th:href="@{/staff/station-grid}">Qu·∫£n l√Ω xe</a></li>
            <li><a th:href="@{/staff/return}">Nh·∫≠n xe</a></li>
            <li><a th:href="@{/staff/deliver}" class="active">Giao xe</a></li>
            <li><a th:href="@{/staff/verify}">X√°c th·ª±c</a></li>
            <li><a th:href="@{/staff/vehicle-reports}">B√°o c√°o s·ª± c·ªë</a></li>
            <li><a th:href="@{/logout}">ƒêƒÉng xu·∫•t</a></li>
        </ul>
    </nav>

    <div class="main-content-staff">
        <header class="content-header-staff">
            <div class="header-title">Giao xe</div>
        </header>

        <main class="content-body-staff">

            <!-- Section T√¨m ki·∫øm -->
            <div class="deliver-search-section">
                <div class="search-row">
                    <div class="search-group">
                        <label for="searchPlate">T√¨m ki·∫øm theo bi·ªÉn s·ªë:</label>
                        <input type="text" id="searchPlate" class="search-input" placeholder="Nh·∫≠p bi·ªÉn s·ªë...">
                    </div>
                    <div class="search-group">
                        <label for="searchCustomer">T√¨m ki·∫øm theo t√™n:</label>
                        <input type="text" id="searchCustomer" class="search-input" placeholder="Nh·∫≠p t√™n kh√°ch h√†ng...">
                    </div>
                </div>
            </div>

            <!-- B·∫£ng danh s√°ch giao xe -->
            <div class="deliver-table-section">
                <table class="deliver-table">
                    <thead>
                        <tr>
                            <th>Bi·ªÉn s·ªë xe</th>
                            <th>Lo·∫°i xe</th>
                            <th>T√™n ng∆∞·ªùi thu√™</th>
                            <th>Ng√†y thu√™</th>
                            <th>Tr·∫°ng th√°i thanh to√°n</th>
                            <th>H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="deliveryTableBody">
                        <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c t·∫£i t·ª´ API -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>
</div>

<!-- Modal Giao xe -->
<div id="deliverModal" class="modal">
    <div class="modal-content deliver-modal-content">
        <div class="modal-header deliver-modal-header">
            <h2>Chi ti·∫øt h·ª£p ƒë·ªìng</h2>
            <button type="button" class="close-btn" onclick="closeDeliverModal()">&times;</button>
        </div>
        <div class="modal-body deliver-modal-body">
            <!-- Ph·∫ßn 1: Th√¥ng tin xe v√† kh√°ch h√†ng -->
            <div class="modal-section">
                <div class="form-grid-2">
                    <div class="form-group">
                        <label>Bi·ªÉn s·ªë xe:</label>
                        <input type="text" id="deliverPlate" disabled>
                    </div>
                    <div class="form-group">
                        <label>Lo·∫°i xe:</label>
                        <input type="text" id="deliverVehicleType" disabled>
                    </div>
                </div>
                <div class="form-group">
                    <label>T√™n ng∆∞·ªùi thu√™:</label>
                    <input type="text" id="deliverCustomer" disabled>
                </div>
            </div>

            <!-- Ph·∫ßn 2: Th√¥ng tin thu√™ xe -->
            <div class="modal-section">
                <h3 class="modal-section-title">üìÖ Th√¥ng tin thu√™ xe</h3>
                <div class="form-grid-3">
                    <div class="form-group">
                        <label>Ng√†y b·∫Øt ƒë·∫ßu:</label>
                        <input type="text" id="deliverStartDate" disabled>
                    </div>
                    <div class="form-group">
                        <label>Ng√†y k·∫øt th√∫c:</label>
                        <input type="text" id="deliverEndDate" disabled>
                    </div>
                    <div class="form-group">
                        <label>S·ªë ng√†y:</label>
                        <input type="text" id="deliverRentalDays" disabled>
                    </div>
                </div>
            </div>

            <!-- Ph·∫ßn 3: Th√¥ng tin thanh to√°n -->
            <div class="modal-section">
                <h3 class="modal-section-title">üí≥ Th√¥ng tin thanh to√°n</h3>
                <div class="form-grid-2">
                    <div class="form-group">
                        <label>T·ªïng ti·ªÅn:</label>
                        <input type="text" id="deliverTotal" disabled>
                    </div>
                    <div class="form-group">
                        <label>Tr·∫°ng th√°i TT:</label>
                        <input type="text" id="deliverPaymentStatus" disabled>
                    </div>
                </div>

                <!-- Hi·ªÉn th·ªã khi paymentStatus = PAY_AT_STATION -->
                <div id="depositInfoSection" style="display: none; margin-top: 15px; padding: 12px; background-color: #f0f8ff; border-left: 4px solid #2196f3; border-radius: 4px;">
                    <div class="form-grid-2">
                        <div class="form-group">
                            <label>üí∞ Ti·ªÅn ƒë√£ ƒë·∫∑t c·ªçc:</label>
                            <input type="text" id="deliverDepositPaidAmount" disabled style="color: #4caf50; font-weight: 600;">
                        </div>
                        <div class="form-group">
                            <label>‚è≥ Ti·ªÅn c√≤n ph·∫£i thanh to√°n:</label>
                            <input type="text" id="deliverRemainingAmount" disabled style="color: #ff9800; font-weight: 600;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ph·∫ßn 4: Ch·ª•p h√¨nh giao xe -->
            <div class="modal-section">
                <h3 class="modal-section-title">üì∏ Ch·ª•p h√¨nh giao xe</h3>
                <div style="border: 2px dashed #ccc; border-radius: 6px; padding: 15px; text-align: center; background-color: #f9f9f9;">
                    <!-- Video t·ª´ camera -->
                    <video id="deliveryVideoStream" autoplay playsinline style="width: 100%; max-height: 250px; border-radius: 6px; display: none; background-color: #000;"></video>

                    <!-- Canvas ƒë·ªÉ ch·ª•p ·∫£nh -->
                    <canvas id="deliveryPhotoCanvas" style="display: none;"></canvas>

                    <!-- Preview ·∫£nh sau khi ch·ª•p -->
                    <div id="deliveryPhotoPreview" style="display: none;">
                        <img id="deliveryPreviewImg" src="" style="max-width: 100%; max-height: 200px; border-radius: 4px;">
                        <p id="deliveryPhotoFileName" style="font-size: 12px; color: #666; margin-top: 5px;"></p>
                    </div>

                    <!-- Buttons -->
                    <div id="deliveryCameraControls">
                        <button type="button" class="btn btn-small btn-small-primary" onclick="startDeliveryCamera()" style="width: auto; padding: 10px 20px; border: none; border-radius: 6px; background-color: #3498db; color: white; cursor: pointer; font-weight: 600; margin: 5px;">
                            üì∑ M·ªü Camera
                        </button>
                    </div>

                    <!-- Capture & Retake buttons (hi·ªÉn th·ªã khi camera ƒëang b·∫≠t) -->
                    <div id="deliveryCaptureControls" style="display: none;">
                        <button type="button" class="btn btn-small" onclick="captureDeliveryPhoto()" style="width: auto; padding: 10px 20px; border: none; border-radius: 6px; background-color: #2ecc71; color: white; cursor: pointer; font-weight: 600; margin: 5px;">
                            üì∏ Ch·ª•p ·∫¢nh
                        </button>
                        <button type="button" class="btn btn-small" onclick="closeDeliveryCamera()" style="width: auto; padding: 10px 20px; border: none; border-radius: 6px; background-color: #e74c3c; color: white; cursor: pointer; font-weight: 600; margin: 5px;">
                            ‚úï ƒê√≥ng Camera
                        </button>
                    </div>

                    <!-- Retake button (hi·ªÉn th·ªã khi ƒë√£ ch·ª•p xong) -->
                    <div id="deliveryRetakeControls" style="display: none;">
                        <button type="button" class="btn btn-small" onclick="resetDeliveryPhoto()" style="width: auto; padding: 10px 20px; border: none; border-radius: 6px; background-color: #f39c12; color: white; cursor: pointer; font-weight: 600; margin: 5px;">
                            üîÑ Ch·ª•p L·∫°i
                        </button>
                    </div>
                </div>
            </div>

            <!-- Ph·∫ßn 5: Ch·ªØ k√Ω x√°c nh·∫≠n -->
            <div class="modal-section">
                <h3 class="modal-section-title">‚úçÔ∏è Ch·ªØ k√Ω x√°c nh·∫≠n</h3>
                <p style="font-size: 14px; color: #666; margin-bottom: 10px;">Kh√°ch h√†ng v√† nh√¢n vi√™n vui l√≤ng k√Ω x√°c nh·∫≠n ƒë√£ ƒë·ªìng √Ω v·ªõi c√°c chi ph√≠ v√† t√¨nh tr·∫°ng xe.</p>
                <div style="border: 2px solid #ddd; border-radius: 6px; overflow: hidden; background-color: #ffffff;">
                    <canvas id="signaturePad" width="600" height="200" style="display: block; cursor: crosshair; width: 100%; touch-action: none;"></canvas>
                </div>
                <div style="margin-top: 10px;">
                    <button type="button" class="btn btn-secondary" onclick="clearSignature()" style="padding: 8px 16px; margin-right: 5px;">
                        üóëÔ∏è X√≥a ch·ªØ k√Ω
                    </button>
                    <span id="signatureStatus" style="font-size: 12px; color: #999; margin-left: 10px;"></span>
                </div>
            </div>

            <!-- Ph·∫ßn 6: Ghi ch√∫ -->
            <div class="modal-section">
                <h3 class="modal-section-title">üìù Ghi ch√∫ giao xe</h3>
                <div class="form-group">
                    <label>Ghi ch√∫:</label>
                    <textarea id="deliverNote" placeholder="Nh·∫≠p ghi ch√∫ (t√πy ch·ªçn)..." rows="3"></textarea>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeDeliverModal()">H·ªßy</button>
            <button type="button" class="btn btn-primary" onclick="confirmDeliver()">X√°c nh·∫≠n giao</button>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<script th:src="@{/js/staff-deliver.js}"></script>

</body>
</html>

